{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "use-carousel-scale",
  "type": "registry:hook",
  "description": "A hook to provide scaling logic for the active item in a carousel.",
  "registryDependencies": [
    "carousel"
  ],
  "files": [
    {
      "path": "registry/hooks/use-carousel-scale.ts",
      "content": "\"use client\";\n\nimport * as React from \"react\";\nimport { type CarouselApi } from \"@/components/ui/carousel\";\n\ntype ScaleCarouselOptions = {\n  minScale?: number;\n  tweenFactorBase?: number;\n};\n\nfunction numberWithinRange(number: number, min: number, max: number) {\n  return Math.min(Math.max(number, min), max);\n}\n\nexport function useCarouselScale(opts?: ScaleCarouselOptions) {\n  const { tweenFactorBase = 0.84, minScale = 0.7 } = opts ?? {};\n\n  const [api, setApi] = React.useState<CarouselApi>();\n  const [current, setCurrent] = React.useState(0);\n  const [count, setCount] = React.useState(0);\n\n  const tweenFactor = React.useRef(0);\n  const tweenNodes = React.useRef<HTMLElement[]>([]);\n\n  const setTweenNodes = React.useCallback((emblaApi: CarouselApi) => {\n    if (!emblaApi) return;\n    tweenNodes.current = emblaApi.slideNodes().map((slideNode) => {\n      return slideNode.childNodes[0] as HTMLElement;\n    });\n  }, []);\n\n  const setTweenFactor = React.useCallback(\n    (emblaApi: CarouselApi) => {\n      if (!emblaApi) return;\n      tweenFactor.current = tweenFactorBase * emblaApi.scrollSnapList().length;\n    },\n    [tweenFactorBase],\n  );\n\n  const tweenScale = React.useCallback((emblaApi: CarouselApi) => {\n    if (!emblaApi) return;\n\n    const engine = emblaApi.internalEngine();\n    const scrollProgress = emblaApi.scrollProgress();\n    const slidesInView = emblaApi.slidesInView();\n\n    emblaApi.scrollSnapList().forEach((scrollSnap, snapIndex) => {\n      let diffToTarget = scrollSnap - scrollProgress;\n      const slidesInSnap = engine.slideRegistry[snapIndex];\n\n      slidesInSnap.forEach((slideIndex) => {\n        if (!slidesInView.includes(slideIndex)) return;\n\n        if (engine.options.loop) {\n          engine.slideLooper.loopPoints.forEach((loopItem) => {\n            const target = loopItem.target();\n            if (slideIndex === loopItem.index && target !== 0) {\n              const sign = Math.sign(target);\n              if (sign === -1) {\n                diffToTarget = scrollSnap - (1 + scrollProgress);\n              }\n              if (sign === 1) {\n                diffToTarget = scrollSnap + (1 - scrollProgress);\n              }\n            }\n          });\n        }\n\n        const tweenValue = 1 - Math.abs(diffToTarget * tweenFactor.current);\n        const scale = numberWithinRange(tweenValue, minScale, 1).toString();\n        const tweenNode = tweenNodes.current[slideIndex];\n        if (tweenNode) {\n          tweenNode.style.transform = `scale(${scale})`;\n        }\n      });\n    });\n  }, []);\n\n  React.useEffect(() => {\n    if (!api) {\n      return;\n    }\n\n    setCount(api.scrollSnapList().length);\n    setCurrent(api.selectedScrollSnap() + 1);\n    setTweenNodes(api);\n    setTweenFactor(api);\n    tweenScale(api);\n\n    api.on(\"select\", () => {\n      setCurrent(api.selectedScrollSnap() + 1);\n      tweenScale(api);\n    });\n\n    api.on(\"scroll\", () => {\n      tweenScale(api);\n    });\n\n    api.on(\"reInit\", () => {\n      setTweenNodes(api);\n      setTweenFactor(api);\n      tweenScale(api);\n      setCount(api.scrollSnapList().length);\n      setCurrent(api.selectedScrollSnap() + 1);\n    });\n  }, [api, setTweenNodes, setTweenFactor, tweenScale]);\n\n  return {\n    setApi,\n    current,\n    count,\n  };\n}\n",
      "type": "registry:hook"
    }
  ]
}